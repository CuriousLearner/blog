<!DOCTYPE html>
<html lang="en">

<head>
            <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="description" content="">
        <meta name="author" content="Sanyam Khurana">


        <title>Improving class instantiation error message logic in Python 3.7</title>

            <link href="feeds/feeds/all.rss.xml" type="application/rss+xml" rel="alternate" title="Sanyam Khurana Full RSS Feed" />
            <link href="feeds/feeds/foss.rss.xml" type="application/rss+xml" rel="alternate" title="Sanyam Khurana Categories RSS Feed" />
        <!-- Bootstrap Core CSS -->
        <link href="http://SanyamKhurana.com/blog/theme/css/bootstrap.min.css" rel="stylesheet">

        <!-- Custom CSS -->
        <link href="http://SanyamKhurana.com/blog/theme/css/clean-blog.min.css" rel="stylesheet">

        <!-- Code highlight color scheme -->
            <link href="http://SanyamKhurana.com/blog/theme/css/code_blocks/darkly.css" rel="stylesheet">


        <!-- Custom Fonts -->
        <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
        <link href='https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
        <link href='https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>

        <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->



        <meta name="description" content="Many folks ask me why I contribute to CPython. I think it is a special feeling which cannot be expressed in words. Even if you just fix ...">

        <meta name="author" content="Sanyam Khurana">

        <meta name="tags" content="foss">
        <meta name="tags" content="python">
        <meta name="tags" content="cpython">

	                <meta property="og:locale" content="">
		<meta property="og:site_name" content="Sanyam Khurana">

	<meta property="og:type" content="article">
            <meta property="article:author" content="Sanyam Khurana" >
	<meta property="og:url" content="http://SanyamKhurana.com/blog/cpython-improve-error-message-logic-for-class-instantiation.html">
	<meta property="og:title" content="Improving class instantiation error message logic in Python 3.7">
	<meta property="article:published_time" content="2017-12-11 20:34:00+05:30">
            <meta property="og:description" content="Many folks ask me why I contribute to CPython. I think it is a special feeling which cannot be expressed in words. Even if you just fix ...">

            <meta property="og:image" content="http://SanyamKhurana.com/blog/theme/images/post-bg.jpg">
</head>

<body>

    <!-- Navigation -->
    <nav class="navbar navbar-default navbar-custom navbar-fixed-top">
        <div class="container-fluid">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header page-scroll">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="http://SanyamKhurana.com/blog/">Sanyam Khurana</a>
            </div>

            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <ul class="nav navbar-nav navbar-right">

                            <li><a href="http://SanyamKhurana.com/blog/pages/about.html">About</a></li>
                            <li><a href="http://SanyamKhurana.com/blog/pages/contact.html">Contact</a></li>
                </ul>
            </div>
            <!-- /.navbar-collapse -->
        </div>
        <!-- /.container -->
    </nav>

    <!-- Page Header -->
        <header class="intro-header" style="background-image: url('http://SanyamKhurana.com/blog/theme/images/post-bg.jpg')">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                    <div class="post-heading">
                        <h1>Improving class instantiation error message logic in Python 3.7</h1>
                        <span class="meta">Posted by
                                <a href="http://SanyamKhurana.com/blog/author/sanyam-khurana.html">Sanyam Khurana</a>
                             on Mon 11 December 2017
                        </span>
                        
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
    <!-- Post Content -->
    <article>
        <p>Many folks ask me why I contribute to CPython. I think it is a special feeling which cannot be expressed in words. Even if you just fix a typo in the doc, believe me, you've actually helped a lot of developers and companies all over the world. Your (small) changes matters a lot. They make huge impact in FOSS world :)</p>
<p>While browsing through bugs on <a class="reference external" href="https://bugs.python.org">bugs.python.org</a> , I found a bug reported by a teacher who requested to enhance the error message logic as he described in one of the blog posts on his blog on <a class="reference external" href="https://blog.lerner.co.il/favorite-terrible-python-error-message/">Favorite Terrible Python Error Message</a>. The <tt class="docutils literal">object_new</tt> and <tt class="docutils literal">object_init</tt> currently have &quot;object&quot; hardcoded in the error messages they raise for excess parameters. It is thus difficult for anyone facing that error to know what is going on.</p>
<p>Nick explained really well about the <a class="reference external" href="https://bugs.python.org/issue31506#msg302439">comment in the bug</a> which I'm stating here:</p>
<div class="highlight"><pre><span class="o">&gt;&gt;&gt;</span> <span class="k">class</span> <span class="nc">C</span><span class="p">:</span> <span class="k">pass</span>
<span class="o">...</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">C</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">):</span>
  <span class="n">File</span> <span class="s">&quot;&lt;stdin&gt;&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">1</span><span class="p">,</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="ne">TypeError</span><span class="p">:</span> <span class="nb">object</span><span class="p">()</span> <span class="n">takes</span> <span class="n">no</span> <span class="n">parameters</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">c</span> <span class="o">=</span> <span class="n">C</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">c</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">):</span>
  <span class="n">File</span> <span class="s">&quot;&lt;stdin&gt;&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">1</span><span class="p">,</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="ne">TypeError</span><span class="p">:</span> <span class="nb">object</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span> <span class="n">takes</span> <span class="n">no</span> <span class="n">parameters</span>


<span class="n">This</span> <span class="n">hardcoding</span> <span class="n">makes</span> <span class="n">sense</span> <span class="k">for</span> <span class="n">the</span> <span class="n">case</span> <span class="n">where</span> <span class="n">that</span> <span class="n">particular</span> <span class="n">method</span> <span class="n">has</span> <span class="n">been</span> <span class="n">overridden</span><span class="p">,</span> <span class="ow">and</span> <span class="n">the</span> <span class="n">interpreter</span> <span class="ow">is</span> <span class="n">reporting</span> <span class="n">an</span> <span class="n">error</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">subclass</span><span class="s">&#39;s call up to the base class, rather than in the call to create an instance of the subclass:</span>
</pre></div>
<div class="highlight"><pre><span class="o">&gt;&gt;&gt;</span> <span class="k">class</span> <span class="nc">D</span><span class="p">:</span>
<span class="o">...</span>     <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
<span class="o">...</span>         <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
<span class="o">...</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">D</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">):</span>
  <span class="n">File</span> <span class="s">&quot;&lt;stdin&gt;&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">1</span><span class="p">,</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
  <span class="n">File</span> <span class="s">&quot;&lt;stdin&gt;&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">3</span><span class="p">,</span> <span class="ow">in</span> <span class="n">__init__</span>
<span class="ne">TypeError</span><span class="p">:</span> <span class="nb">object</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span> <span class="n">takes</span> <span class="n">no</span> <span class="n">parameters</span>


<span class="n">However</span><span class="p">,</span> <span class="n">it</span><span class="s">&#39;s misleading in the case where object_new is reporting an error because it knows object_init hasn&#39;</span><span class="n">t</span> <span class="n">been</span> <span class="n">overridden</span> <span class="p">(</span><span class="ow">or</span> <span class="n">vice</span><span class="o">-</span><span class="n">versa</span><span class="p">),</span> <span class="ow">and</span> <span class="n">hence</span> <span class="n">won</span><span class="s">&#39;t correctly accept any additional arguments: in those cases, it would be far more useful to report &quot;type-&gt;tp_name&quot; in the error message, rather than hardcoding &quot;object&quot;.</span>
</pre></div>
<p>I thus started working on the patch to detect the cases when <tt class="docutils literal">excess_args</tt> are supplied and show the correct error message.</p>
<blockquote>
<p>Now the error messages in <cite>object.__new__</cite> and <cite>object.__init__</cite> aim
to point the user more directly at the name of the class being instantiated
in cases where they <em>haven't</em> been overridden (on the assumption that
the actual problem is a missing <cite>__new__</cite> or <cite>__init__</cite> definition in the
class body).</p>
<p>When they <em>have</em> been overridden, the errors still report themselves as
coming from the object, on the assumption that the problem is with the call
up to the base class in the method implementation, rather than with the
way the constructor is being called.</p>
</blockquote>
<p>If you're interested, you can see the whole <a class="reference external" href="https://github.com/python/cpython/commit/780acc89bccf9999332d334a27887684cc942eb6">patch here</a>.
I hope this patch would help all those kids and all the new and old folks playing with Python to learn about how objects are created and instantiated. It always feels great to make (small) changes. Helping in improving Python one patch at a time :)</p>

    </article>

        <div class="tags">
            <p>tags: <a href="http://SanyamKhurana.com/blog/tag/foss.html">foss</a>, <a href="http://SanyamKhurana.com/blog/tag/python.html">python</a>, <a href="http://SanyamKhurana.com/blog/tag/cpython.html">cpython</a>, </p>
        </div>

<hr>
<div class="sharing">
</div>
    <hr>

        <div class="comments">
            <h2>Comments !</h2>
            <div id="disqus_thread"></div>
            <script type="text/javascript">
                var disqus_shortname = 'curiouslearner';
                var disqus_identifier = 'cpython-improve-error-message-logic-for-class-instantiation.html';
                var disqus_url = 'http://SanyamKhurana.com/blog/cpython-improve-error-message-logic-for-class-instantiation.html';
                (function() {
                    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                    dsq.src = '//curiouslearner.disqus.com/embed.js';
                    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                })();
            </script>
            <noscript>Please enable JavaScript to view the comments.</noscript>
        </div>
            </div>
        </div>
    </div>

    <hr>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                    <ul class="list-inline text-center">
                            <li>
                                <a href="https://twitter.com/ErSanyamKhurana">
                                    <span class="fa-stack fa-lg">
                                        <i class="fa fa-circle fa-stack-2x"></i>
                                        <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                                    </span>
                                </a>
                            </li>
                            <li>
                                <a href="https://github.com/CuriousLearner">
                                    <span class="fa-stack fa-lg">
                                        <i class="fa fa-circle fa-stack-2x"></i>
                                        <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                                    </span>
                                </a>
                            </li>
                            <li>
                                <a href="https://facebook.com/CuriousLearner">
                                    <span class="fa-stack fa-lg">
                                        <i class="fa fa-circle fa-stack-2x"></i>
                                        <i class="fa fa-facebook fa-stack-1x fa-inverse"></i>
                                    </span>
                                </a>
                            </li>
                            <li>
                                <a href="mailto:sanyam@sanyamkhurana.com">
                                    <span class="fa-stack fa-lg">
                                        <i class="fa fa-circle fa-stack-2x"></i>
                                        <i class="fa fa-envelope fa-stack-1x fa-inverse"></i>
                                    </span>
                                </a>
                            </li>
                            <li>
                                <a href="http://www.sanyamkhurana.com/blog/feeds/all.rss.xml">
                                    <span class="fa-stack fa-lg">
                                        <i class="fa fa-circle fa-stack-2x"></i>
                                        <i class="fa fa-feed fa-stack-1x fa-inverse"></i>
                                    </span>
                                </a>
                            </li>
                    </ul>
<p class="copyright text-muted">
    Blog powered by <a href="http://getpelican.com">Pelican</a>,
    which takes great advantage of <a href="http://python.org">Python</a>.
</p>                </div>
            </div>
        </div>
    </footer>

    <!-- jQuery -->
    <script src="http://SanyamKhurana.com/blog/theme/js/jquery.js"></script>

    <!-- Bootstrap Core JavaScript -->
    <script src="http://SanyamKhurana.com/blog/theme/js/bootstrap.min.js"></script>

        <!-- Custom Theme JavaScript -->
        <script src="http://SanyamKhurana.com/blog/theme/js/clean-blog.min.js"></script>

    <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-61049901-1']);
    _gaq.push(['_trackPageview']);
    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    </script>
<script type="text/javascript">
    var disqus_shortname = 'curiouslearner';
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
</body>

</html>